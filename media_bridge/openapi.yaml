openapi: 3.1.0
info:
  title: Notion Autopilot Media Bridge
  version: "1.0.0"
  description: >
    Middleware API for GPT Actions that need to upload files to services that
    require raw bytes (Notion file uploads, Google Drive uploads).
    For multi-user Notion OAuth in GPT Actions, use same-domain auth URLs:
    `/oauth/notion/authorize` and `/oauth/notion/token`.
servers:
  - url: https://YOUR_MEDIA_BRIDGE_HOST

components:
  schemas:
    OpenAIFileRefsRequest:
      type: object
      properties:
        openaiFileIdRefs:
          type: array
          minItems: 1
          items:
            type: string
          description: Attach files in chat; Action runtime fills this automatically.
      required:
        - openaiFileIdRefs
    DriveUploadRequest:
      type: object
      properties:
        folder_name:
          type: string
          description: Folder name for uploaded files.
        openaiFileIdRefs:
          type: array
          minItems: 1
          items:
            type: string
          description: Attach files in chat; Action runtime fills this automatically.
      required:
        - openaiFileIdRefs
    InlineNotionUploadFile:
      type: object
      properties:
        name:
          type: string
        mime_type:
          type: string
        data_base64:
          type: string
          description: Base64 encoded file bytes.
      required:
        - name
        - data_base64
    InlineNotionUploadRequest:
      type: object
      properties:
        files:
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/InlineNotionUploadFile"
      required:
        - files
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: OAuth 2.0 access token

paths:
  /health:
    get:
      operationId: health
      summary: Health check
      responses:
        "200":
          description: OK

  /v1/notion/file_uploads:
    post:
      operationId: notionFileUploads
      summary: Upload files to Notion
      description: >
        Uploads files from `openaiFileIdRefs` to Notion and returns `file_upload_id` values.
        By default the bridge behaves as an uploader only.
        Optional PDF/PPTX page expansion can be enabled via `PDF_EXTRACT_MODE=page`.
        If `NOTION_TOKEN` is set on the service, no per-request auth is required.
      security:
        - {}
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OpenAIFileRefsRequest"
      responses:
        "200":
          description: OK

  /v1/drive/upload_public:
    post:
      operationId: driveUploadPublic
      summary: Upload files to Google Drive and make public
      description: >
        Requires an OAuth access token sent by the Action runtime as `Authorization: Bearer ...`.
        Expects `openaiFileIdRefs` containing file references from the conversation.
        By default the bridge behaves as an uploader only.
        Optional PDF/PPTX page expansion can be enabled via `PDF_EXTRACT_MODE=page`.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DriveUploadRequest"
      responses:
        "200":
          description: OK

  /v1/notion/file_uploads_from_data:
    post:
      operationId: notionFileUploadsFromData
      summary: Upload base64 files to Notion
      description: >
        Uploads inline base64 file bytes to Notion and returns `file_upload_id` values.
        Use this when files exist only in sandbox/code output and not as chat attachments.
      security:
        - {}
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InlineNotionUploadRequest"
      responses:
        "200":
          description: OK
